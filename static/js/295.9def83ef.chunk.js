"use strict";(self.webpackChunk_example_website=self.webpackChunk_example_website||[]).push([[295],{86295:function(n,e,o){o.r(e),e.default={components:{},data:{},source:"# \u6570\u636e\u6d41\n@umijs/max \u5185\u7f6e\u4e86\u6570\u636e\u6d41\u7ba1\u7406\u63d2\u4ef6\uff0c\u5b83\u662f\u4e00\u79cd\u57fa\u4e8e hooks \u8303\u5f0f\u7684\u8f7b\u91cf\u7ea7\u6570\u636e\u7ba1\u7406\u65b9\u6848\uff0c\u53ef\u4ee5\u5728 antdp \u9879\u76ee\u4e2d\u7ba1\u7406\u5168\u5c40\u7684\u5171\u4eab\u6570\u636e\u3002\n\n```ts\n// config/config.ts\nimport config from '@antdp/config';\nimport proxy from './proxy';\nimport router from './router.json';\nexport default config(router, {\n  proxy,\n  define: {\n  model: {},\n});\n```\n## \u5f00\u59cb\u4f7f\u7528\n\n### \u521b\u5efa Model\n\n\u6570\u636e\u6d41\u7ba1\u7406\u63d2\u4ef6\u91c7\u7528\u7ea6\u5b9a\u5f0f\u76ee\u5f55\u7ed3\u6784\uff0c\u6211\u4eec\u7ea6\u5b9a\u53ef\u4ee5\u5728 `src/models`, `src/pages/xxxx/models/`\u76ee\u5f55\u4e2d\uff0c\u548c `src/pages/xxxx/model.{js,jsx,ts,tsx}` \u6587\u4ef6\u5f15\u5165 Model \u6587\u4ef6\u3002 Model \u6587\u4ef6\u5141\u8bb8\u4f7f\u7528 `.(tsx|ts|jsx|js)` \u56db\u79cd\u540e\u7f00\u683c\u5f0f\uff0c\u547d\u540d\u7a7a\u95f4\uff08namespace\uff09 \u751f\u6210\u89c4\u5219\u5982\u4e0b\u3002\n\n| \u8def\u5f84 | \u547d\u540d\u7a7a\u95f4 | \u8bf4\u660e |\n| :--- |:--- | :--- |\n| `src/models/count.ts` | `count` | `src/models` \u76ee\u5f55\u4e0b\u4e0d\u652f\u6301\u76ee\u5f55\u5d4c\u5957\u5b9a\u4e49 model |\n| `src/pages/pageA/model.ts` | `pageA.model` |  |\n| `src/pages/pageB/models/product.ts` | `pageB.product` |  |\n| `src/pages/pageB/models/fruit/apple.ts` | `pageB.fruit.apple` |  `pages/xxx/models` \u4e0b model \u5b9a\u4e49\u652f\u6301\u5d4c\u5957\u5b9a\u4e49 |\n\n\u6240\u8c13\u7684 Model\uff0c\u5c31\u662f\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684 `hooks`\uff0c\u6ca1\u6709\u4efb\u4f55\u4f7f\u7528\u8005\u9700\u8981\u5173\u6ce8\u7684\u201c\u9ed1\u9b54\u6cd5\u201d\u3002\n\n\u5f53\u6211\u4eec\u9700\u8981\u83b7\u53d6 Model \u4e2d\u7684\u5168\u5c40\u6570\u636e\u65f6\uff0c\u8c03\u7528\u8be5\u547d\u540d\u7a7a\u95f4\u5373\u53ef\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e Model \u6587\u4ef6 `userModel.ts`\uff0c\u5b83\u7684\u547d\u540d\u7a7a\u95f4\u4e3a `userModel`\u3002\n\n\u7f16\u5199\u4e00\u4e2a\u9ed8\u8ba4\u5bfc\u51fa\u7684\u51fd\u6570\uff1a\n\n```ts\n// src/models/userModel.ts\nexport default function Page() {\n  const user = {\n    username: 'umi',\n  };\n\n  return { user };\n};\n```\n\n\u8fd9\u5c31\u662f\u4e00\u4e2a Model\u3002\u63d2\u4ef6\u6240\u505a\u7684\u5de5\u4f5c\u5c31\u662f\u5c06\u5176\u4e2d\u7684\u72b6\u6001\u6216\u6570\u636e\u53d8\u6210\u4e86**\u5168\u5c40\u6570\u636e**\uff0c\u4e0d\u540c\u7684\u7ec4\u4ef6\u5728\u4f7f\u7528\u8be5 Model \u65f6\uff0c\u62ff\u5230\u7684\u662f\u540c\u4e00\u4efd\u72b6\u6001\u6216\u6570\u636e\u3002\n\n<strong>\nModel \u6587\u4ef6\u9700\u8981\u9ed8\u8ba4\u5bfc\u51fa\u4e00\u4e2a\u51fd\u6570\uff0c\u6b64\u51fd\u6570\u5b9a\u4e49\u4e86\u4e00\u4e2a `hook`\u3002\u5bf9\u4e8e\u4e0d\u7b26\u5408\u6b64\u89c4\u8303\u7684\u6587\u4ef6\uff0c\u5c06\u4f1a\u88ab\u8fc7\u6ee4\u6389\uff0c\u5e76\u65e0\u6cd5\u901a\u8fc7\u547d\u540d\u7a7a\u95f4\u8c03\u7528\u3002\n</strong>\n\nModel \u4e2d\u5141\u8bb8\u4f7f\u7528\u5176\u5b83 `hooks`\uff0c\u4ee5\u8ba1\u6570\u5668\u4e3a\u4f8b\uff1a\n\n```ts\n// src/models/counterModel.ts\nimport { useState, useCallback } from 'react';\n\nexport default function Page() {\n  const [counter, setCounter] = useState(0);\n\n  const increment = useCallback(() => setCounter((c) => c + 1), []);\n  const decrement = useCallback(() => setCounter((c) => c - 1), []);\n\n  return { counter, increment, decrement };\n};\n```\n\n\u5728\u9879\u76ee\u5b9e\u8df5\u4e2d\uff0c\u6211\u4eec\u901a\u5e38\u9700\u8981\u8bf7\u6c42\u540e\u7aef\u63a5\u53e3\uff0c\u6765\u83b7\u53d6\u6240\u9700\u7684\u6570\u636e\u3002\u73b0\u5728\u8ba9\u6211\u4eec\u6765\u6269\u5c55\u524d\u9762\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u7684\u4f8b\u5b50\uff1a\n\n```ts\n// src/models/userModel.ts\nimport { useState } from 'react';\nimport { getUser } from '@/services/user';\n\nexport default function Page() {\n  const [user, setUser] = useState({});\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    getUser().then((res) => {\n      setUser(res);\n      setLoading(false);\n    });\n  }, []);\n\n  return {\n    user,\n    loading,\n  };\n};\n```\n\n\u5982\u679c\u60a8\u5728\u9879\u76ee\u4e2d\u4f7f\u7528\u4e86 [ahooks](https://ahooks.js.org)\uff0c\u53ef\u4ee5\u50cf\u8fd9\u6837\u7ec4\u7ec7\u60a8\u7684\u4ee3\u7801\uff1a\n\n```ts\n// src/models/userModel.ts\nimport { useRequest } from 'ahooks';\nimport { getUser } from '@/services/user';\n\nexport default function Page() {\n  const { data: user, loading: loading } = useRequest(async () => {\n    const res = await getUser();\n    if (res) {\n      return res;\n    }\n    return {};\n  });\n\n  return {\n    user,\n    loading,\n  };\n};\n```\n\n### \u4f7f\u7528 Model\n\n\u73b0\u5728\uff0c\u60a8\u60f3\u8981\u5728\u67d0\u4e2a\u7ec4\u4ef6\u4e2d\u4f7f\u7528\u5168\u5c40\u7684 Model\u3002\u4ee5\u7528\u6237\u4fe1\u606f\u4e3a\u4f8b\uff0c\u53ea\u9700\u8981\u8c03\u7528 `useModel` \u8fd9\u4e00\u94a9\u5b50\u51fd\u6570\uff1a\n\n```tsx\n// src/components/Username/index.tsx\nimport { useModel } from '@umijs/max';\n\nexport default function Page() {\n  const { user, loading } = useModel('userModel');\n\n  return (\n    {loading ? <></>: <div>{user.username}</div>}\n  );\n}\n```\n\n\u5176\u4e2d\uff0c`useModel()` \u65b9\u6cd5\u4f20\u5165\u7684\u53c2\u6570\u4e3a Model \u7684**\u547d\u540d\u7a7a\u95f4**\u3002\n\n## \u6027\u80fd\u4f18\u5316\n\n`useModel()` \u65b9\u6cd5\u53ef\u4ee5\u63a5\u53d7\u53ef\u9009\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff0c\u5f53\u7ec4\u4ef6\u53ea\u9700\u8981\u4f7f\u7528 Model \u4e2d\u7684\u90e8\u5206\u53c2\u6570\uff0c\u800c\u5bf9\u5176\u5b83\u53c2\u6570\u7684\u53d8\u5316\u4e0d\u611f\u5174\u8da3\u65f6\uff0c\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2a\u51fd\u6570\u8fdb\u884c\u8fc7\u6ee4\u3002\u4ee5\u5b9e\u73b0\u8ba1\u6570\u5668\u7684\u64cd\u4f5c\u6309\u94ae\u4e3a\u4f8b\uff1a\n\n```tsx\n// src/components/CounterActions/index.tsx\nimport { useModel } from '@umijs/max';\n\nexport default function Page() {\n  const { add, minus } = useModel('counterModel', (model) => ({\n    add: model.increment,\n    minus: model.decrement,\n  }));\n\n  return (\n    <div>\n      <button onClick={add}>add by 1</button>\n      <button onClick={minus}>minus by 1</button>\n    </div>\n  );\n};\n```\n\n\u4e0a\u9762\u7684\u7ec4\u4ef6\u5e76\u4e0d\u5173\u5fc3\u8ba1\u6570\u5668 Model \u4e2d\u7684 `counter` \u503c\uff0c\u53ea\u9700\u8981\u4f7f\u7528 Model \u63d0\u4f9b\u7684 `increment()` \u548c `decrement()` \u65b9\u6cd5\u3002\u4e8e\u662f\u6211\u4eec\u4f20\u5165\u4e86\u4e00\u4e2a\u51fd\u6570\u4f5c\u4e3a `useModel()` \u65b9\u6cd5\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff0c\u8be5\u51fd\u6570\u7684\u8fd4\u56de\u503c\u5c06\u4f5c\u4e3a `useModel()` \u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u3002\n\n\u8fd9\u6837\uff0c\u6211\u4eec\u8fc7\u6ee4\u6389\u4e86 `counter` \u8fd9\u4e00\u9891\u7e41\u53d8\u5316\u7684\u503c\uff0c\u907f\u514d\u4e86\u7ec4\u4ef6\u91cd\u590d\u6e32\u67d3\u5e26\u6765\u7684\u6027\u80fd\u635f\u5931\u3002\n\n## API\n\n### `useModel`\n\n`useModel()` \u662f\u4e00\u4e2a\u94a9\u5b50\u51fd\u6570\uff0c\u63d0\u4f9b\u4e86\u4f7f\u7528 Model \u7684\u80fd\u529b\u3002\u5b83\u63a5\u53d7\u4e24\u4e2a\u53c2\u6570\uff1a\n\n| \u53c2\u6570 | \u7c7b\u578b | \u4ecb\u7ecd |\n| --- | --- | --- |\n| `namespace` | `String` | Model \u6587\u4ef6\u7684\u547d\u540d\u7a7a\u95f4 |\n| `updater` | `(model: any) => any` | \u53ef\u9009\u53c2\u6570\u3002\u4f20\u5165\u4e00\u4e2a\u51fd\u6570\uff0c\u51fd\u6570\u7684\u8fd4\u56de\u503c\u4e3a\u5f53\u524d\u7ec4\u4ef6\u4e2d\u9700\u8981\u4f7f\u7528\u5230\u7684 Model \u72b6\u6001\u6216\u6570\u636e\uff0c\u5e76\u4f5c\u4e3a `useModel()` \u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u3002\u5bf9\u4f18\u5316\u7ec4\u4ef6\u6027\u80fd\u5177\u6709\u91cd\u8981\u610f\u4e49\u3002 |\n\n```tsx\n// src/components/AdminInfo/index.tsx\nimport { useModel } from 'umi';\n\nexport default function Page() {\n  const { user, fetchUser } = useModel('adminModel', (model) => ({\n    user: model.admin,\n    fetchUser: model.fetchAdmin,\n  }));\n\n  return <>hello</>;\n};\n```"}}}]);
//# sourceMappingURL=295.9def83ef.chunk.js.map